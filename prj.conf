CONFIG_MAIN_STACK_SIZE=2048
CONFIG_COMMON_LIBC_MALLOC_ARENA_SIZE=8192
CONFIG_DISK_ACCESS=y
CONFIG_DISK_DRIVERS=y
CONFIG_FILE_SYSTEM=y
CONFIG_FAT_FILESYSTEM_ELM=y
CONFIG_SDMMC_STM32_HWFC=y
CONFIG_HWINFO=y

CONFIG_USB_DEVICE_STACK_NEXT=y
CONFIG_USBD_MSC_CLASS=y
CONFIG_LOG=y
CONFIG_SDMMC_STM32=y
CONFIG_DISK_DRIVER_SDMMC=y
CONFIG_USBD_MSC_LUNS_PER_INSTANCE=1
# Reduce all USB and disk logging to avoid timing issues
CONFIG_USBD_LOG_LEVEL_WRN=y
CONFIG_USBD_MSC_LOG_LEVEL_WRN=y
CONFIG_UDC_DRIVER_LOG_LEVEL_WRN=y
CONFIG_SDMMC_LOG_LEVEL_WRN=y
CONFIG_DISK_LOG_LEVEL_WRN=y
CONFIG_USBD_MSC_SCSI_BUFFER_SIZE=4096
CONFIG_USBD_MSC_DOUBLE_BUFFERING=y
CONFIG_CACHE_MANAGEMENT=y
CONFIG_UDC_BUF_POOL_SIZE=16384
CONFIG_UDC_BUF_COUNT=32
CONFIG_DCACHE_LINE_SIZE=32

# Memory configuration for STM32U5 USB and SDMMC DMA
CONFIG_NOCACHE_MEMORY=y
CONFIG_ARM_MPU=y
CONFIG_DCACHE=y